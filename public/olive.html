<!DOCTYPE html>
<html lang="ko">

<head>
        <meta charset="UTF-8">
        <title>ì˜¬ë¦¬ë¸Œì˜ ë­í‚¹</title>
        <link rel="stylesheet" href="olive.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <h1>ì˜¬ë¦¬ë¸Œì˜ ë­í‚¹
            <h4>HWASEON</h4>
        </h1>
        
        <div class="filters">
            <label for="category">ì¹´í…Œê³ ë¦¬ :</label>
            <select id="category">
                <option value="ìŠ¤í‚¨ì¼€ì–´">ìŠ¤í‚¨ì¼€ì–´</option>
                <option value="ë§ˆìŠ¤í¬íŒ©">ë§ˆìŠ¤í¬íŒ©</option>
                <option value="í´ë Œì§•">í´ë Œì§•</option>
                <option value="ì„ ì¼€ì–´">ì„ ì¼€ì–´</option>
                <option value="ë©”ì´í¬ì—…">ë©”ì´í¬ì—…</option>
                <option value="ë„¤ì¼">ë„¤ì¼</option>
                <option value="ë·°í‹°ì†Œí’ˆ">ë·°í‹°ì†Œí’ˆ</option>
                <option value="ë”ëª¨_ì½”ìŠ¤ë©”í‹±">ë”ëª¨ ì½”ìŠ¤ë©”í‹±</option>
                <option value="ë§¨ì¦ˆì¼€ì–´">ë§¨ì¦ˆì¼€ì–´</option>
                <option value="í–¥ìˆ˜_ë””í“¨ì €">í–¥ìˆ˜/ë””í“¨ì €</option>
                <option value="í—¤ì–´ì¼€ì–´">í—¤ì–´ì¼€ì–´</option>
                <option value="ë°”ë””ì¼€ì–´">ë°”ë””ì¼€ì–´</option>
                <option value="ê±´ê°•ì‹í’ˆ">ê±´ê°•ì‹í’ˆ</option>
                <option value="í‘¸ë“œ">í‘¸ë“œ</option>
                <option value="êµ¬ê°•ìš©í’ˆ">êµ¬ê°•ìš©í’ˆ</option>
                <option value="í—¬ìŠ¤_ê±´ê°•ìš©í’ˆ">í—¬ìŠ¤/ê±´ê°•ìš©í’ˆ</option>
                <option value="ì—¬ì„±_ìœ„ìƒìš©í’ˆ">ì—¬ì„±/ìœ„ìƒìš©í’ˆ</option>
                <option value="íŒ¨ì…˜">íŒ¨ì…˜</option>
                <option value="ë¦¬ë¹™_ê°€ì „">ë¦¬ë¹™/ê°€ì „</option>
                <option value="ì·¨ë¯¸_íŒ¬ì‹œ">ì·¨ë¯¸/íŒ¬ì‹œ</option>
            </select>

            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
            <label for="startDate"> ë‚ ì§œ ì„ íƒ :</label>
            <input type="date" id="startDate">
            <label>~</label>
            <input type="date" id="endDate">
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
            <label>ì œí’ˆëª… ê²€ìƒ‰ : </label>
            <input type="text" id="productSearchInput" placeholder="ì˜ˆì‹œ : ì„¸ëŸ¼ , ì•°í”Œ"/>
            <button id="productSearchBtn">ğŸ”</button>
            
            
        </div>

        <div style="display: flex; align-items: center; justify-content: center; height: 32px; margin-top: -15px;">
            <span style="color: rgba(0, 0, 0, 0.6); font-size: 17px;">
            â€» 2024.05.03 ë¶€í„° ë°ì´í„° ì¡°íšŒ ê°€ëŠ¥
            </span>
        </div>


        <div style="text-align: center; margin-top:50px;">
            <button id="searchBtn">ë­í‚¹ ë°ì´í„°</button>
            <button id="productSearchDownloadBtn" style="margin-left:80px;">ì œí’ˆëª… : Excel ë‹¤ìš´ë¡œë“œ</button>
            <button id="downloadExcelBtn" style="margin-left:80px;">ë­í‚¹ : Excel ë‹¤ìš´ë¡œë“œ</button>
            <button id="captureBtn" style="margin-left:80px;">ìº¡ì²˜</button>
            <button id="showCapturesBtn" style="margin-left:2cap;">ìº¡ì²˜ ëª©ë¡</button>
        </div>

        <!-- ìº¡ì²˜ ëª©ë¡ ëª¨ë‹¬ -->
        <div id="captureListModal" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">ìº¡ì²˜ ëª©ë¡</h3>
                        <button type="button" class="btn-close" onclick="closeCaptureListModal();">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="captureListContainer">
                            <!-- ìº¡ì²˜ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
                </div>
                
        <div class="table-container">
                <h2>ì œí’ˆëª… ë°ì´í„°</h2>
            <div id="updateTime" style="text-align: right; margin-bottom: 10px; color: #666; font-size: 14px;"></div>
            <table id="productSearchTable">
                <thead>
                        <tr>
                            <th>ë‚ ì§œ</th>
                            <th>ì¹´í…Œê³ ë¦¬</th>
                            <th>ìˆœìœ„</th>
                            <th>ë¸Œëœë“œ</th>
                            <th>ì œí’ˆëª…</th>
                            <th>ì†Œë¹„ìê°€</th>
                            <th>íŒë§¤ê°€</th>
                            <th>í–‰ì‚¬</th>
                        </tr>
                </thead>
                <tbody>
                    <!-- ê²€ìƒ‰ ê²°ê³¼ -->
                </tbody>
            </table>
        </div>

        <div class="table-container">
        <div style="margin-top: 30px;"></div>
            <h2>ë­í‚¹ ë°ì´í„°</h2>
            <div id="rankingUpdateTime" style="text-align: right; margin-bottom: 10px; color: #666; font-size: 14px;"></div>
            <table id="rankingTable">
                <thead>
                    <tr>
                        <th>ë‚ ì§œ</th>
                        <th>ì¹´í…Œê³ ë¦¬</th>
                        <th>ìˆœìœ„</th>
                        <th>ë¸Œëœë“œ</th>
                        <th>ì œí’ˆëª…</th>
                        <th>ì†Œë¹„ìê°€</th>
                        <th>íŒë§¤ê°€</th>
                        <th>í–‰ì‚¬</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- js -->
                </tbody>
            </table>
        </div>
    </div>
    
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>

    <style>
        /* ìˆœìœ„ ë³€ë™ ìŠ¤íƒ€ì¼ */
        .rank-change {
            display: inline-flex;
            align-items: center;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .rank-up {
            color: #2196F3;  /* íŒŒë€ìƒ‰ */
            background-color: rgba(33, 150, 243, 0.1);
        }
        
        .rank-down {
            color: #F44336;  /* ë¹¨ê°„ìƒ‰ */
            background-color: rgba(244, 67, 54, 0.1);
        }
        
        .rank-same {
            color: #757575;  /* íšŒìƒ‰ */
        }
        
        .rank-new {
            color: #4CAF50;  /* ì´ˆë¡ìƒ‰ */
            background-color: rgba(76, 175, 80, 0.1);
        }
    </style>

    <script>
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) {
                return 'ë°©ê¸ˆ ì „ ì—…ë°ì´íŠ¸';
            } else if (diffInSeconds < 3600) {
                const minutes = Math.floor(diffInSeconds / 60);
                return `${minutes}ë¶„ ì „ ì—…ë°ì´íŠ¸`;
            } else if (diffInSeconds < 86400) {
                const hours = Math.floor(diffInSeconds / 3600);
                const minutes = Math.floor((diffInSeconds % 3600) / 60);
                return `${hours}ì‹œê°„ ${minutes}ë¶„ ì „ ì—…ë°ì´íŠ¸`;
            } else {
                const days = Math.floor(diffInSeconds / 86400);
                return `${days}ì¼ ì „ ì—…ë°ì´íŠ¸`;
            }
        }

        function updateTable(rankings, latestCrawl) {
            const tbody = document.querySelector('#rankingTable tbody');
            tbody.innerHTML = '';

            if (!Array.isArray(rankings) || rankings.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="8">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>`;
                tbody.appendChild(row);
                return;
            }

            // ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
            if (latestCrawl) {
                const updateTimeDiv = document.getElementById('rankingUpdateTime');
                updateTimeDiv.textContent = formatTimeAgo(latestCrawl);
            }

            // ê°€ì¥ ìµœê·¼ í¬ë¡¤ë§ ë°ì´í„°ë§Œ í‘œì‹œ
            const latestCrawlTime = rankings[0]?.crawled_at;
            const latestRankings = rankings.filter(item => item.crawled_at === latestCrawlTime);

            latestRankings.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.date} ${item.crawled_at_formatted}</td>
                    <td>${item.category}</td>
                    <td>${item.rank}</td>
                    <td>${item.brand}</td>
                    <td>${item.product}</td>
                    <td>${item.originalPrice}</td>
                    <td>${item.salePrice}</td>
                    <td>${item.event}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>

