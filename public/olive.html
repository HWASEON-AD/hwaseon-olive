<!DOCTYPE html>
<html lang="ko">

<head>
        <meta charset="UTF-8">
        <title>올리브영 랭킹</title>
        <link rel="stylesheet" href="olive.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <h1>올리브영 랭킹
            <h4>HWASEON</h4>
        </h1>
        
        <div class="filters">
            <label for="category">카테고리 :</label>
            <select id="category">
                <option value="스킨케어">스킨케어</option>
                <option value="마스크팩">마스크팩</option>
                <option value="클렌징">클렌징</option>
                <option value="선케어">선케어</option>
                <option value="메이크업">메이크업</option>
                <option value="네일">네일</option>
                <option value="뷰티소품">뷰티소품</option>
                <option value="더모_코스메틱">더모 코스메틱</option>
                <option value="맨즈케어">맨즈케어</option>
                <option value="향수_디퓨저">향수/디퓨저</option>
                <option value="헤어케어">헤어케어</option>
                <option value="바디케어">바디케어</option>
                <option value="건강식품">건강식품</option>
                <option value="푸드">푸드</option>
                <option value="구강용품">구강용품</option>
                <option value="헬스_건강용품">헬스/건강용품</option>
                <option value="여성_위생용품">여성/위생용품</option>
                <option value="패션">패션</option>
                <option value="리빙_가전">리빙/가전</option>
                <option value="취미_팬시">취미/팬시</option>
            </select>

            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
            <label for="startDate"> 날짜 선택 :</label>
            <input type="date" id="startDate">
            <label>~</label>
            <input type="date" id="endDate">
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
            <label>제품명 검색 : </label>
            <input type="text" id="productSearchInput" placeholder="예시 : 세럼 , 앰플"/>
            <button id="productSearchBtn">🔍</button>
            
            
        </div>

        <div style="display: flex; align-items: center; justify-content: center; height: 32px; margin-top: -15px;">
            <span style="color: rgba(0, 0, 0, 0.6); font-size: 17px;">
            ※ 2024.05.03 부터 데이터 조회 가능
            </span>
        </div>


        <div style="text-align: center; margin-top:50px;">
            <button id="searchBtn">랭킹 데이터</button>
            <button id="productSearchDownloadBtn" style="margin-left:80px;">제품명 : Excel 다운로드</button>
            <button id="downloadExcelBtn" style="margin-left:80px;">랭킹 : Excel 다운로드</button>
            <button id="captureBtn" style="margin-left:80px;">캡처</button>
            <button id="showCapturesBtn" style="margin-left:2cap;">캡처 목록</button>
        </div>

        <!-- 캡처 목록 모달 -->
        <div id="captureListModal" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">캡처 목록</h3>
                        <button type="button" class="btn-close" onclick="closeCaptureListModal();">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="captureListContainer">
                            <!-- 캡처 목록이 여기에 동적으로 로드됩니다 -->
                        </div>
                    </div>
                </div>
            </div>
                </div>
                
        <div class="table-container">
                <h2>제품명 데이터</h2>
            <div id="updateTime" style="text-align: right; margin-bottom: 10px; color: #666; font-size: 14px;"></div>
            <table id="productSearchTable">
                <thead>
                        <tr>
                            <th>날짜</th>
                            <th>카테고리</th>
                            <th>순위</th>
                            <th>브랜드</th>
                            <th>제품명</th>
                            <th>소비자가</th>
                            <th>판매가</th>
                            <th>행사</th>
                        </tr>
                </thead>
                <tbody>
                    <!-- 검색 결과 -->
                </tbody>
            </table>
        </div>

        <div class="table-container">
        <div style="margin-top: 30px;"></div>
            <h2>랭킹 데이터</h2>
            <div id="rankingUpdateTime" style="text-align: right; margin-bottom: 10px; color: #666; font-size: 14px;"></div>
            <table id="rankingTable">
                <thead>
                    <tr>
                        <th>날짜</th>
                        <th>카테고리</th>
                        <th>순위</th>
                        <th>브랜드</th>
                        <th>제품명</th>
                        <th>소비자가</th>
                        <th>판매가</th>
                        <th>행사</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- js -->
                </tbody>
            </table>
        </div>
    </div>
    
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>

    <style>
        /* 순위 변동 스타일 */
        .rank-change {
            display: inline-flex;
            align-items: center;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .rank-up {
            color: #2196F3;  /* 파란색 */
            background-color: rgba(33, 150, 243, 0.1);
        }
        
        .rank-down {
            color: #F44336;  /* 빨간색 */
            background-color: rgba(244, 67, 54, 0.1);
        }
        
        .rank-same {
            color: #757575;  /* 회색 */
        }
        
        .rank-new {
            color: #4CAF50;  /* 초록색 */
            background-color: rgba(76, 175, 80, 0.1);
        }
    </style>

    <script>
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) {
                return '방금 전 업데이트';
            } else if (diffInSeconds < 3600) {
                const minutes = Math.floor(diffInSeconds / 60);
                return `${minutes}분 전 업데이트`;
            } else if (diffInSeconds < 86400) {
                const hours = Math.floor(diffInSeconds / 3600);
                const minutes = Math.floor((diffInSeconds % 3600) / 60);
                return `${hours}시간 ${minutes}분 전 업데이트`;
            } else {
                const days = Math.floor(diffInSeconds / 86400);
                return `${days}일 전 업데이트`;
            }
        }

        function updateTable(rankings, latestCrawl) {
            const tbody = document.querySelector('#rankingTable tbody');
            tbody.innerHTML = '';

            if (!Array.isArray(rankings) || rankings.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="8">데이터가 없습니다.</td>`;
                tbody.appendChild(row);
                return;
            }

            // 업데이트 시간 표시
            if (latestCrawl) {
                const updateTimeDiv = document.getElementById('rankingUpdateTime');
                updateTimeDiv.textContent = formatTimeAgo(latestCrawl);
            }

            // 가장 최근 크롤링 데이터만 표시
            const latestCrawlTime = rankings[0]?.crawled_at;
            const latestRankings = rankings.filter(item => item.crawled_at === latestCrawlTime);

            latestRankings.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.date} ${item.crawled_at_formatted}</td>
                    <td>${item.category}</td>
                    <td>${item.rank}</td>
                    <td>${item.brand}</td>
                    <td>${item.product}</td>
                    <td>${item.originalPrice}</td>
                    <td>${item.salePrice}</td>
                    <td>${item.event}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>

